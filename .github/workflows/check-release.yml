name: Check Release
on:
  workflow_dispatch:
  schedule:
    - cron: '0 */12 * * *' # every 12 hours
jobs:
  check:
    name: ðŸ“¡  Regular checks
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ”§  Set up Node
        uses: actions/setup-node@v1
        with:
          node-version: 14.x
      - name: ðŸ’¿  Check last template version
        run: echo "LAST_VERSION=$(git branch --sort=-committerdate --no-merged | head -n 1)" >> $GITHUB_ENV
      - name: ðŸ”¬  Check next release version
        run: echo "REMIX_VERSION=$(npm info remix time --json | jq 'keys_unsorted | .[index(env.LAST_VERSION) + 1] | select (.!=null)')" >> $GITHUB_ENV
      - name: ðŸš€  Invoke Update Template workflow
        uses: benc-uk/workflow-dispatch@v1
        if: ${{ env.REMIX_VERSION != '' }}
        with:
          workflow: Update Template
          ref: main
          token: ${{ secrets.PERSONAL_TOKEN }}
          inputs: '{ "version": "${{ env.REMIX_VERSION }}" }'
